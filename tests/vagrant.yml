---
# file: primogen/tests/vagrant.yml

- name: set host entries play
  hosts: 127.0.0.1
  connection: local
  gather_facts: no

  vars:
    hosts_file: /etc/hosts

  tasks:
    - name: set entry in /etc/hosts
      lineinfile:
        dest="{{ hosts_file }}"
        line="{{ item.value.network.ip }} {{ item.key }}"
        state=present
        follow=yes
        insertafter=EOF
      with_dict: vagrant
      when: item.value.enabled
      sudo: yes


- name: idempotence test play
  hosts: all
  gather_facts: yes
  remote_user: vagrant

  roles:
    - primogen


- name: clear host entries play
  hosts: 127.0.0.1
  connection: local
  gather_facts: no

  vars:
    hosts_file: /etc/hosts

  tasks:
    - name: clear entry in /etc/hosts
      lineinfile:
        dest="{{ hosts_file }}"
        regexp=".*{{ item.key }}$"
        state=absent
        follow=yes
      with_dict: vagrant
      sudo: yes
